<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Your Cart | ShopSmart AI</title>
    <link rel="stylesheet" href="css/style.css">
    <!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-5VV5XK6KZE"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-5VV5XK6KZE');
</script>
</head>

<body>

<!-- NAVBAR -->
<header class="navbar">

    <h1 class="logo">ShopSmart AI</h1>
    <nav id="navLinks">
        <a href="index.html">Home</a>
        <a href="products.html">Products</a>

        <a href="cart.html" class="active">
            Cart <span id="cartCount" class="cart-badge">0</span>
        </a>

        <a href="about.html">About</a>
        <a href="contact.html">Contact</a>
        <a href="feedback.html">Feedback</a>
        
    </nav>
</header>

<!-- CART TITLE -->
<header>
    <h1 style="text-align:center;">Your Cart</h1>
</header>

<!-- CART ITEMS -->
<section class="products" id="cartItems"></section>

<h2 style="text-align:center;">
    Total: â‚¹<span id="total">0</span>
</h2>

<div style="text-align:center; margin:20px;">
    <a href="checkout.html" class="btn">Proceed to Checkout</a>
</div>

<!-- ================= CART SCRIPT ================= -->
<script>
let cart = JSON.parse(localStorage.getItem("cart")) || [];
const container = document.getElementById("cartItems");
const totalEl = document.getElementById("total");

function renderCart() {
    container.innerHTML = "";
    let total = 0;

    if (cart.length === 0) {
        container.innerHTML = "<p style='text-align:center;'>Your cart is empty ðŸ›’</p>";
        totalEl.innerText = "0";
        return;
    }

    cart.forEach((item, index) => {
        const price = Number(item.price) || 0;
        const qty = Number(item.quantity) || 1;
        const subtotal = price * qty;
        total += subtotal;

        container.innerHTML += `
        <div class="product">
            <img src="${item.image || '../images/placeholder.png'}"
                 style="width:120px; display:block; margin:auto;">

            <h3>${item.name}</h3>
            <p>â‚¹${price.toLocaleString()}</p>

            <div style="margin:10px 0;">
                <button onclick="updateQty(${index}, -1)">âˆ’</button>
                <span style="margin:0 10px;">${qty}</span>
                <button onclick="updateQty(${index}, 1)">+</button>
            </div>

            <p><b>Subtotal:</b> â‚¹${subtotal.toLocaleString()}</p>

            <button class="btn" onclick="removeItem(${index})">Remove</button>
        </div>
        `;
    });

    totalEl.innerText = total.toLocaleString();
}

function updateQty(index, change) {
    cart[index].quantity += change;

    if (cart[index].quantity <= 0) {
        cart.splice(index, 1);
    }

    localStorage.setItem("cart", JSON.stringify(cart));
    renderCart();
    updateCartCount();
}

function removeItem(index) {
    cart.splice(index, 1);
    localStorage.setItem("cart", JSON.stringify(cart));
    renderCart();
    updateCartCount();
}

function updateCartCount() {
    let count = 0;
    cart.forEach(item => count += item.quantity || 1);
    const badge = document.getElementById("cartCount");
    if (badge) badge.innerText = count;
}

renderCart();
updateCartCount();
</script>

<!-- ACTIVE NAV LINK -->
<script>
const links = document.querySelectorAll(".navbar nav a");
const current = window.location.pathname.split("/").pop();

links.forEach(link => {
    if (link.getAttribute("href") === current) {
        link.classList.add("active");
    }
});
</script>

<script>
const user = JSON.parse(localStorage.getItem("loggedInUser"));
const nav = document.getElementById("navLinks");

if (!nav) return;

// ADMIN LINK
if (user && user.role === "admin") {
    const adminLink = document.createElement("a");
    adminLink.href = "admin.html";
    adminLink.innerText = "Admin";
    nav.appendChild(adminLink);
}

// LOGIN / LOGOUT
if (user) {
    const logout = document.createElement("a");
    logout.href = "#";
    logout.innerText = "Logout";
    logout.onclick = () => {
        localStorage.removeItem("loggedInUser");
        alert("Logged out successfully");
        window.location.href = "login.html";
    };
    nav.appendChild(logout);
} else {
    const login = document.createElement("a");
    login.href = "login.html";
    login.innerText = "Login";
    nav.appendChild(login);
}
</script>

<script>
document.addEventListener("DOMContentLoaded", () => {

    const user = JSON.parse(localStorage.getItem("loggedInUser"));
    const nav = document.getElementById("navLinks");

    if (!nav) {
        console.error("navLinks not found");
        return;
    }

    // ADMIN LINK
    if (user && user.role === "admin") {
        const adminLink = document.createElement("a");
        adminLink.href = "admin.html";
        adminLink.innerText = "Admin";
        nav.appendChild(adminLink);
    }

    // LOGIN / LOGOUT
    if (user) {
        const logout = document.createElement("a");
        logout.href = "#";
        logout.innerText = "Logout";
        logout.onclick = () => {
            localStorage.removeItem("loggedInUser");
            alert("Logged out successfully");
            window.location.href = "login.html";
        };
        nav.appendChild(logout);
    } else {
        const login = document.createElement("a");
        login.href = "login.html";
        login.innerText = "Login";
        nav.appendChild(login);
    }
});
</script>


</body>
</html>
